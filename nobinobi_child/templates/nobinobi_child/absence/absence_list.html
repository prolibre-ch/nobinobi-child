  {% extends "nobinobi_child/base.html" %}
  {% load i18n static %}

  {% block title %}{{ title }}{% endblock %}

  {% block extrastyle %}
    <link rel="stylesheet" type="text/css" href="{% static 'vendor/DataTables/datatables.min.css' %}"/>
  {% endblock %}

  {% block content_title_block %}
    <h1>{{ title }}</h1>
  {% endblock %}

  {% block breadcrumb %}
    {{ block.super }}
    <li class="breadcrumb-item active">{{ title }}</li>
  {% endblock %}


  {% block content_card %}
    <div class="card-body">
      <table id="absences_datatables" class="display table" style="width:100%">
        <thead>
        <tr>
          <th>{% trans "Child" %}</th>
          <th>{% trans "Start date" %}</th>
          <th>{% trans "End date" %}</th>
          <th>{% trans "Type" %}</th>
          <th>{% trans "Actions" %}</th>
        </tr>
        </thead>
      </table>
    </div>
    <!-- modal instanstiation -->
    {% include "includes/modal.html" %}
  {% endblock %}

  {% block extrajs %}
    <script src="{% static 'js/jquery.bootstrap.modal.forms.min.js' %}"></script>
    <script src="{% static 'vendor/DataTables/datatables.min.js' %}"></script>
    <script>
      let table = null;
      $(document).ready(function () {
        {#jQuery.noConflict();#}
        table = $('#absences_datatables').DataTable({
          "language": {
            "url": "{% static 'vendor/DataTables/DataTables-1.10.18/i18n/French.json' %}"
          },
          "ajax": {
            url: "{% url 'nobinobi_child:api-absence-list' %}",
            dataSrc: ''
          },
          "columns": [
            {data: "child"},
            {data: "start_date"},
            {data: "end_date"},
            {data: "type"},
            {
              data: null,
              render: function (row, index, datatable) {
                return '<div class="btn-group">' +
                  '{% if perms.nobinobi_child.delete_absence %}' +
                    '<button data-id="{% url "nobinobi_child:Absence_detail" pk=123 %}" class="absence-detail btn btn-info"><i class="fa fa-eye"></i></button>'.replace(123, row.id)
                    +
                    '{% endif %}' +
                  '{% if perms.nobinobi_child.change_absence %}' +
                    '<button data-id="{% url "nobinobi_child:Absence_update" pk=123 %}" class="absence-update btn btn-primary"><i class="fa fa-edit"></i></button>'.replace(123, row.id)
                    +
                    '{% endif %}' +
                  '{% if perms.nobinobi_child.delete_absence %}' +
                    '<button data-id="{% url "nobinobi_child:Absence_delete" pk=123 %}" class="absence-delete btn btn-danger"><i class="fa fa-times"></i></button>'.replace(123, row.id)
                    +
                    '{% endif %}' +
                  '</div>';
              },
            },
          ],
          "columnDefs": [{
            "targets": -1,
            "searchable": false,
            "orderable": false,
          }],
          dom: 'Bfrtip',
          buttons: [
            {
              text: '{% trans "Add" %}',
              action: function (dt, index, btn) {
                {% if perms.nobinobi_child.add_absence %}
                  btn.modalForm({formURL: "{% url 'nobinobi_child:Absence_create' %}"});
                {% else %}
                  alert("{% trans "Your permission is insufficient." %}");
                {% endif %}
              },
            },
            'copyHtml5',
            'print',
            'csvHtml5',
            'pdfHtml5',
          ],
          responsive: true,
          {#"searchCols": [#}
          {#  {"search": 'in_progress'},#}
          {#],#}
        });
        table.on('draw', function () {
          create_event_button();
        });
        table.on('responsive-display', function (e, datatable, row, showHide, update) {
          create_event_button();
        });
      });

      function create_event_button() {
        // Create absence button
        $(".absence-create").modalForm({formURL: "{% url 'nobinobi_child:Absence_create' %}"});

        // Update absence buttons
        $(".absence-update").each(function () {
          $(this).modalForm({formURL: $(this).data('id')});
        });

        // Read absence buttons
        $(".absence-detail").each(function () {
          $(this).modalForm({formURL: $(this).data('id')});
        });

        // Delete absence buttons
        $(".absence-delete").each(function () {
          $(this).modalForm({formURL: $(this).data('id')});
        });
      }

    </script>

  {% endblock %}
